#include <stdio.h>
#include <string.h>

char * format(char *string);
char tmp_string[100];

int main(){
  FILE *fp1;
  FILE *fp2;
  const int BUFFER = 100;
  const int DATA_SIZE = 5;
  char input[BUFFER];
  char *temp[7];
  char temp1[DATA_SIZE];
  char temp2[DATA_SIZE];
  char temp3[DATA_SIZE];
  char temp4[DATA_SIZE];
  char temp5[DATA_SIZE];
  char temp6[DATA_SIZE];
  char temp7[DATA_SIZE];
  char address[BUFFER];
  char value[BUFFER];
  int test;

  
  fp1 = fopen("mag2cfg.h", "r");
  fp2 = fopen("output.txt", "w");

  while(fgets(input, BUFFER, fp1) != NULL){
    strcpy(address,"");
    strcpy(value,"");
    strcpy(temp1,"");
    strcpy(temp2,"");
    strcpy(temp3,"");
    strcpy(temp4,"");
    strcpy(temp5,"");
    strcpy(temp6,"");
    strcpy(temp7,"");
    
    test=sscanf(input,"%s %s %s %s %s %s %s",temp1, temp2, temp3, temp4, temp5, temp6, temp7);
    
    if((!strcmp(temp1,"0x00,"))&&test){
     
      //printf("%s %s %s %s %s %s\n",temp2,temp3,temp4,temp5,temp6,temp7);
      strcat(temp2,temp3);
      strcat(temp2,temp4);
      strcat(temp5, temp6);
      strcat(temp5, temp7);
      strcpy(address,format(temp2));
      strcpy(value,format(temp5));
      fprintf(fp2,"0x%s,0x%s\n",address, value);
    }
  }

  fclose(fp1);
  fclose(fp2);
  return 0;  
}

char * format(char string[]){
  int count = 0;
  int tmp_count = 0;
  
  while(string[count]){
    if((string[count]!=' ')&&(string[count]!='x')&&(string[count]!=',')){
      //printf("%c\n",string[count]);
      tmp_string[tmp_count]=string[count];
      tmp_count++;
    }
    else if(string[count]=='x'){
      tmp_count--;
    }
    count++;
  }
  return tmp_string;
}
